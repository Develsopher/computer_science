
# CPU
## CPU 용어
### 클럭
+ 컴퓨터 부품들은 **클럭신호에 맞춰 움직임**

+ CPU는 명령어 사이클이라는 정해진 흐름에 맞춰 명령어를 진행

+ **클럭속도**(Hz) : 1초에 클럭이 몇번 반복되는가
	+ 클럭속도는 일정하지 않다
	+ 클럭이 높다고 성능이 좋은 것도 아니다( 발열 ♨)


### 멀티코어 : 코어가 두개 이상인것
+ **코어** : CPU는 명령어를 실행하는 부품이라는 뜻이다 => 오늘날에는 **코어**로 사용된다
+ **코어가 여러 개**인 CPU는 **명령어를 실행하는 부품이 여러 개**인 것으로 판단하면 된다.
+ 하지만 코어가 많다고 성능이 좋아지는 것은 아니다. (Ex **사공이 많은 배**)
> ![](https://i.imgur.com/pGttoB9.png)

### 멀티 스레드
+ 스레드 : 실행 흐름의 단위 (**주의 !** 프로그래밍에서 쓰이는 스레드와 다름)
	
	**하드웨어적 스레드**
	+ 하나의 코어가 동시에 처리하는 **명령어 단위**
	+ **스레드**가 여러개라면 코어 1개가 여러 개의 명령어를 동시에 실행할 수 있음
	
	**결론**
	+ 하나의 코어로 여러 명령어를 동시에 처리하는 CPU를 **멀티스레드 프로세서** 또는 **멀티스레드 CPU**라고 한다


	**소프트웨어적 스레드**
	+ 하나의 프로그램에서 독립적으로 실행되는 단위
	+ 하나의 프로그램은 여러 부분이 동시에 실행될 수 있음
	
	 + **EX** 사용자로부터 입력받은 내용을 화면에 보여 주는 기능 / 
	    사용자가 입력한 내용이 맞춤법에 맞는지 검사하는 기능 /
	    사용자가 입력한 내용을 수시로 저장하는 기능


### 멀티스레드 프로세서
+ 하나의 코어로 **여러 명령어를 동시에 처리하는 CPU**
+ 핵심은 레지스터임
+ 레지스터가 있어야만 프로그램 카운터가 저장되므로 여러개의 명령어를 저장하고 전달할수있음

> **잠깐** 프로세스와 스레드의 차이점은?

> **프로세스** : 메모리 상에서 실행중인 프로그램
> **스레드** : 프로세스 안에서 실행되는 흐름 단위


### 논리 프로세서
+ 그림을 보면 코어가 2개에 스레드가 4인 CPU임을 알 수 있음
  ![](https://i.imgur.com/i170p3s.png)

> 프로그램의 입장에서는 하나의 명령어를 처리하는 CPU가 4개 있는 것으로 보임
> 
> 따라서 하드웨어 스레드를 **논리 프로세서**라고 부름 


## 명령어 병렬 처리 기법
+ 빠른 CPU를 위해서는 CPU가 놀지않고 알뜰하게 작동하게 만드는 것도 중요함
### 1. 명령어 파이프라인
+ 명령어 처리 과정을 클럭 단위로 나누기
1. 명령어 인출
2. 명령어 해석
3. 명령어 실행
4. 결과 저장

![](https://i.imgur.com/yJxTC7q.png)

+ 명령어 파이프라이닝 : 명령어들을 명령어 파이프라인에 넣고 동시에 처리하는 기법
#### 파이프라인 위험
- 파이프라이닝이 높은 성능을 가져오나 특정상황에는 성능향상을 실패하는 경우
##### **데이터 위험** : 명령어 간 데이터 의존성에 의해 발생
+ 1,2,3,4 명령어가 있다고 가정
+ 3명령어에서 1의 데이터값이 필요
+ 하지만 3명령어가 실행될때 1데이터가 저장이 안되는 상황발생

##### **제어위험** : 프로그램 카운터의 갑작스러운 변화에 의해 발생
+ **프로그램 카운터의 갑작스러운 변화**에 의해 발생
+ 보통 프로그램 카운터는 실행 중인 명령어의 다음주소로 갱신
+ 갑작스럽게 실행 흐름이 바뀌어서 **다음 주소가 아닌 곳으로 이동**하면 기존의 명령어가 쓸모가 없어짐
![](https://i.imgur.com/9xiqbXz.png)

+ 이를 방지하고자 사용하는 기술이 **분기 예측**임

##### **구조적 위험**
- 명령어들이 겹쳐 실행하는 과정에 서로 다른 명령어가 동시에 CPU부품을 사용할 때 발생
- **자원위험**이라고도 부름


### 2. 슈퍼스칼라
+ 파이프라이닝은 단일 파이프라인으로도 구현이 가능함
+ 현재는 여러개의 파이프라인을 사용하는데 이를 **슈퍼스칼라**라고 부름
+ 사진을 보면 두 개씩 명령어를 처리하는 것을 볼 수 있음
![](https://i.imgur.com/SuX0YA1.png)


#### 스퍼스칼라 프로세서/CPU
+ 슈퍼스칼라 구조로 명령어 처리가 가능한 CPU

### 3. 비순차적 명령어 처리
+ **OoOE**(out-of-order execution)라고 부름
+ 명령어들을 **순차적으로 실행하지 않는 기법**

**Ex** 3번 명령어는 1번과 2번 명령어가 저장되야 실행가능한 명령어임

![](https://i.imgur.com/qsICwr6.png)
+ 3번 명령어의 순서를 미루어도 문제될것이 없기 때문에 순서를 바꿀 수 있다
![](https://i.imgur.com/hVXM61o.png)

+ 명령이 바뀔 때 지장이 없어야만 이 기법을 사용할 수 있음

## CISC 와 RISC
+ 파이프라이닝하기 쉬운 명령어에 대한 소개
### 1. ISA(**명령어 집합**)
+  CPU가 이해할 수 있는 명령어들의 모음 
	+ 모든 CPU가 모두 같은 **명령어**를 실행하지 않음
	+ 명령어의 생김새, 연산, 주소 지정 방식이 조금씩 다름

 > 따라서 명령어를 읽기 편하게 만든 언어인 **어셈블리어**가 달라짐 
     => **CPU 하드웨어** 설계 또한 달라지게 됨
     > ISA에도 명령어 병렬 처리 기법에 적합한 ISA와 그렇지 않은 ISA가 있음

### 2. CISC(Complex Instruction Set Coumputer)
+  복잡하고 다양한 명령어를 활용하는 설계방식

#### 장점
+ 명령어의 형태,크기가 다양한 **가변길이 명령어**를 사용
+ 적은 수의 명령어로도 프로그램을 실행할 수 있음
> 메모리 절약 가능
#### 단점
+ 명령어의 크기와 실행시간이 일정하지 않고 하나의 명령에 여러 클럭주기가 필요
+ 자주쓰던 명령어만 사용하게됨
![](https://i.imgur.com/TfjPOuf.png)

### 3. RISC(Reduced Instruction Set Computer)
+ CISC와 달리 **고정 길이 명령어**를 사용하고 명령어 종류가 적음
+ 규격화된 명령어로 파이프라이닝의 최적호됨
+ 메모리 접근 명령어가 load store로 제한되어있음
+ 대신 레지스터를 적극 활용해야함


| 구분              | CISC                        | RISC                 |
| ----------------- |:--------------------------- |:-------------------- |
| 뜻                | 복잡하고 다양한 명령어      | 단순하고 적은명령어  |
| 명령어            | 가변 길이 명령어            | 고정 길이 명령어     |
| 주소지정방식      | 다양함                      | 적음                 |
| 프로그램 명령어수 | 적음                        | 많음                 |
| 클럭              | 여러클럭에 걸쳐 명령어 수행 | 한클럭에 명령어 수행 |
| 파이프라이닝      | 어려움                      | 쉬움                 |
